<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>UPP: 2D-decomp.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">UPP
   &#160;<span id="projectnumber">11.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('2D-decomp_8md.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">2D-decomp.md</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;# 2-D Decomposition Overview</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;**Author:** George Vandenberghe</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;**Date:** June 2022</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;## Comparison of 1D vs. 2D Decomposition</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;The 1D decomposition can read state from a model forecast file, either by reading on rank 0 and scattering, or by doing MPI_IO on the model history file using either nemsio, sigio, or netcdf serial or parallel I/O. Very old post tags also implement the more primitive full state broadcast or (a performance bug rectified 10/17) read the entire state on all tasks. This is mentioned in case a very old tag is encountered.  </div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;The 2D decomposition only supports MPI_IO, namely NetCDF Parallel I/O. But the code is backwards compatible and all I/O methods remain supported for the 1D decomposition cases and works for all cases currently supported by older 1D tags and branches.</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;## 2D Decomposition Design </div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;The 2D decomposition operates on subdomains with some latitudes and some longitudes.  The subdomains are lon-lat rectangles rather than strips. This means state must be chopped into pieces in any scatter operation and the pieces reassembled in any gather operation that requires a continuous in memory state. I/O and halo exchanges both require significantly more bookkeeping.</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;The structural changes needed for the 2D decomposition are implemented in MPI_FIRST.f and CTLBLK.f. The CTLBLK.f routine contains numerous additional variables describing left and right domain boundaries. Many additional changes are also implemented in EXCH.f to support 2D halos.  Many additional routines required addition of the longitude subdomain limits but changes to the layouts are handled in CTLBLK.f and the &quot;many additional routines&quot; do not require additional changes when subdomain shapes are changed and have not been a trouble point.</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;Both MPI_FIRST.f and EXCH.f contain significant additional test code to exchange arrays containing grid coordinates and ensure EXACT matches for all exchanges before the domain exchanges are performed. This is intended to trap errors in the larger variety of 2D decomposition layouts that are possible and most of it can eventually be removed or made conditional at build and run time.</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;The following is found in CTLBLK.f and shared in the rest of UPP through use of CTLBLK.mod:</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;| Variable | Type | Description |</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;|---------|------|-------------|</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;| im | integer |  full longitude domain|</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;| jm | integer |  full latitude domain|</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;| | | | </div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;| jsta | integer |  start latitude on a task subdomain|</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;| jend | integer |   end  latitude on a task subdomain|</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;| ista | integer  | start longitude on a task subdomain|</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;| iend  | integer |  end   longitude on a task subdomain|</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;| | | | </div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;| ista_2l | integer |start longitude -2 of the subdomain|</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;| iend_2u | integer |end   longitude +2 of the subdomain|</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;| jsta_2l | integer |start latitude  -2 of the subdomain|</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;| jend_2u | integer |end   latitude  +2 of the subdomain|</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;The shape of the subdomain is ista_2l:iend_2u,jsta_2l:jend_2u so it includes the halos although the halos are not populated until exchange is done in EXCH.f.  Because of halos we need more bounds defined:</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;| Variable | Type | Description |</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;|---------|------|-------------|</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;| jsta_m |  integer |  Beginning latitude loop index in subdomain for halo depth 1 |</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;| jend_m |   integer |   ending latitude loop index in subdomain for halo depth 1      |</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;| jsta_m2 |  integer |   second latitude below begin latitude of subdomain for halo depth 2 (in NGMFLD.f) |</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;| jend_m2 |   integer |  second latitude above end latitude of subdomain for halo depth 2 ( in NGMFLD.f) |</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;Note:&lt;ul&gt;&lt;li&gt;In interior subdomains these are the same as jsta and jend.&lt;/li&gt;&lt;li&gt;In boundary subdomains these loop indices define a smaller subset of the subdomain since halos are not defined on the full domain boundaries and stencils must be restricted to valid full domain points. &lt;/li&gt;&lt;/ul&gt;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;| Variable | Type | Description |</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;|---------|------|-------------| </div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;|  ista_m |  integer  |  begining longitude loop index in subdomain for halo depth 1|</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;|  iend_m |  integer  |  end longitude loop index in subdomain  for halo depth 1 |</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;|  ista_m2 |  integer  |  second longitude before begin longitude for halo depth 2  (not used as of 6/22)|</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;|  iend_m2 |  integer  | second longitude after end  longitude    for halo depth 2  (not used as of 6/22) |</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;Note:&lt;ul&gt;&lt;li&gt;In interior subdomains these are the same as ista and iend.&lt;/li&gt;&lt;li&gt;In boundary subdomains these loop indices define a smaller subset of the subdomain since halos are not defined on the full domain boundaries and stencils must be restricted to valid full domain points.&lt;/li&gt;&lt;/ul&gt;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;| Variable | Type | Description |</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;|---------|------|-------------| </div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;|  ileft |  integer |  MPI rank containing the last longitude before ista </div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;|  iright |  integer |  MPI rank containing the first longitude after iend</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;|  iup   |  integer |   MPI rank containing the first latitude after jend</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;|  idn |  integer |     MPI rank containing the  last latitude before  jsta</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;| | | |</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;|  ileftb  | integer |MPI rank containing the last longitude before ista but for cyclic boundary conditions where &quot;last&quot; at the beginning is the other end of the domain (apparently unused and replaced with local calculation) |</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;|  irightb | integer |  MPI rank containing the first longitude after iend but for cyclic boundary conditions where &quot;first&quot; at the beginning is the other end of the domain (apparently unused and replaced with local calculation) |</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div></div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><b>2D-decomp.md</b></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
